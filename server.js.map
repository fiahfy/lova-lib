{"version":3,"file":"../../server.js","sources":["webpack:///webpack/bootstrap af557bbb293ff55971bd","webpack:///./src/server.js","webpack:///./src/server/config/app.js","webpack:///./src/server/controllers/index.js","webpack:///./src/server/controllers/prizes.js","webpack:///./src/server/models/index.js","webpack:///./src/server/config/mongodb.js","webpack:///./src/server/utils/logger.js","webpack:///./src/server/models/counter.js","webpack:///./src/server/models/prize.js","webpack:///./src/server/models/servant.js","webpack:///./src/server/models/servantranking.js","webpack:///./src/server/models/spellranking.js","webpack:///./src/server/controllers/root.js","webpack:///./src/server/controllers/servants-statistics.js","webpack:///./src/server/controllers/servants.js","webpack:///./src/server/controllers/sitemap.js","webpack:///./src/server/controllers/spells-statistics.js","webpack:///./src/server/controllers/ranking/index.js","webpack:///./src/server/controllers/ranking/servants.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/assets/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap af557bbb293ff55971bd\n **/","'use strict';\n\nrequire('babel-polyfill');\n\nvar _app = require('./server/config/app');\n\nvar _app2 = _interopRequireDefault(_app);\n\nvar _koa = require('koa');\n\nvar _koa2 = _interopRequireDefault(_koa);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar app = (0, _koa2.default)();\n\n_app2.default.route(app);\n\napp.listen(_app2.default.port, _app2.default.ip);\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server.js\n ** module id = 0\n ** module chunks = 0\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _koaRouter = require('koa-router');\n\nvar _koaRouter2 = _interopRequireDefault(_koaRouter);\n\nvar _koaStatic = require('koa-static');\n\nvar _koaStatic2 = _interopRequireDefault(_koaStatic);\n\nvar _koaSend = require('koa-send');\n\nvar _koaSend2 = _interopRequireDefault(_koaSend);\n\nvar _crypto = require('crypto');\n\nvar _crypto2 = _interopRequireDefault(_crypto);\n\nvar _lruCache = require('lru-cache');\n\nvar _lruCache2 = _interopRequireDefault(_lruCache);\n\nvar _controllers = require('../controllers');\n\nvar _controllers2 = _interopRequireDefault(_controllers);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar router = (0, _koaRouter2.default)();\n\nvar cache = (0, _lruCache2.default)({ maxAge: 1000 * 60 });\n\nvar config = {\n  port: process.env.OPENSHIFT_NODEJS_PORT || 3000,\n  ip: process.env.OPENSHIFT_NODEJS_IP || '127.0.0.1',\n  development: process.env.OPENSHIFT_NODEJS_IP === undefined\n};\n\nconfig.route = function (app) {\n  app.use(regeneratorRuntime.mark(function _callee(next) {\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!(this.path.indexOf('/api/') > -1)) {\n              _context.next = 5;\n              break;\n            }\n\n            _context.next = 3;\n            return next;\n\n          case 3:\n            _context.next = 12;\n            break;\n\n          case 5:\n            if (!(this.path.indexOf('.') > -1)) {\n              _context.next = 10;\n              break;\n            }\n\n            _context.next = 8;\n            return next;\n\n          case 8:\n            _context.next = 12;\n            break;\n\n          case 10:\n            _context.next = 12;\n            return (0, _koaSend2.default)(this, '/index.html', { root: 'public' });\n\n          case 12:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n  app.use((0, _koaStatic2.default)('public', { maxage: 10 * 60 * 1000 }));\n  if (!config.development) {\n    app.use(regeneratorRuntime.mark(function _callee2(next) {\n      var key, value;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(this.path.indexOf('.') > -1)) {\n                _context2.next = 5;\n                break;\n              }\n\n              _context2.next = 3;\n              return next;\n\n            case 3:\n              _context2.next = 13;\n              break;\n\n            case 5:\n              key = _crypto2.default.createHash('md5').update(this.url).digest('hex');\n              value = cache.get(key);\n\n              if (!value) {\n                _context2.next = 10;\n                break;\n              }\n\n              this.body = value;\n              return _context2.abrupt('return');\n\n            case 10:\n              _context2.next = 12;\n              return next;\n\n            case 12:\n              cache.set(key, this.body);\n\n            case 13:\n            case 'end':\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n  }\n  router.get('/sitemap.xml', _controllers2.default.sitemap);\n  router.get('/api/', _controllers2.default.root);\n  router.get('/api/servants/', _controllers2.default.servants);\n  router.get('/api/servants/:id/', _controllers2.default.servants);\n  router.get('/api/prizes/', _controllers2.default.prizes);\n  /// deprecated\n  router.get('/api/ranking/servants/:mode/:year/:month/:date/', _controllers2.default.ranking.servants);\n  router.get('/api/ranking/servants/:mode/latest/', _controllers2.default.ranking.servants);\n  router.get('/api/ranking/servants/:id/:mode/:year/:month/:date/', _controllers2.default.ranking.servants);\n  ///\n  router.get('/api/servants/statistics/', _controllers2.default.servantsStatistics);\n  router.get('/api/spells/statistics/', _controllers2.default.spellsStatistics);\n  app.use(router.routes());\n};\n\nexports.default = config;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/config/app.js\n ** module id = 2\n ** module chunks = 0\n **/","'use strict';\n\n// let fs = require('fs');\n//\n// fs.readdirSync(__dirname).forEach(function(file) {\n//   if (file !== 'index.js') {\n//     let fileName = file.split('.')[0];\n//     let moduleName = fileName.replace(/-(\\w)/, function(match, p1, offset, string) {\n//       return p1.toUpperCase();\n//     });\n//     module.exports[moduleName] = require('./' + fileName);\n//   }\n// });\n\nmodule.exports = {\n  prizes: require('./prizes'),\n  root: require('./root'),\n  servantsStatistics: require('./servants-statistics'),\n  servants: require('./servants'),\n  sitemap: require('./sitemap'),\n  spellsStatistics: require('./spells-statistics'),\n  ranking: require('./ranking')\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/controllers/index.js\n ** module id = 8\n ** module chunks = 0\n **/","'use strict';\n\nvar _marked = [prizes].map(regeneratorRuntime.mark);\n\nvar models = require('../models');\n\nfunction prizes() {\n  return regeneratorRuntime.wrap(function prizes$(_context) {\n    while (1) switch (_context.prev = _context.next) {\n      case 0:\n        _context.next = 2;\n        return models.prize.find({}).exec();\n\n      case 2:\n        this.body = _context.sent;\n\n      case 3:\n      case 'end':\n        return _context.stop();\n    }\n  }, _marked[0], this);\n}\n\nmodule.exports = prizes;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/controllers/prizes.js\n ** module id = 9\n ** module chunks = 0\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.spellranking = exports.servantranking = exports.prize = exports.servant = exports.counter = undefined;\n\nvar _counter = require('./counter');\n\nObject.defineProperty(exports, 'counter', {\n  enumerable: true,\n  get: function get() {\n    return _counter.default;\n  }\n});\n\nvar _servant = require('./servant');\n\nObject.defineProperty(exports, 'servant', {\n  enumerable: true,\n  get: function get() {\n    return _servant.default;\n  }\n});\n\nvar _prize = require('./prize');\n\nObject.defineProperty(exports, 'prize', {\n  enumerable: true,\n  get: function get() {\n    return _prize.default;\n  }\n});\n\nvar _servantranking = require('./servantranking');\n\nObject.defineProperty(exports, 'servantranking', {\n  enumerable: true,\n  get: function get() {\n    return _servantranking.default;\n  }\n});\n\nvar _spellranking = require('./spellranking');\n\nObject.defineProperty(exports, 'spellranking', {\n  enumerable: true,\n  get: function get() {\n    return _spellranking.default;\n  }\n});\n\nvar _fs = require('fs');\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar _mongoose = require('mongoose');\n\nvar _mongoose2 = _interopRequireDefault(_mongoose);\n\nvar _mongodb = require('../config/mongodb');\n\nvar _mongodb2 = _interopRequireDefault(_mongodb);\n\nvar _logger = require('../utils/logger');\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_mongoose2.default.connect(_mongodb2.default.uri);\n\n_mongoose2.default.connection.on('connected', function () {\n  _logger2.default.info('Mongoose default connection open to ' + _mongodb2.default.uri);\n});\n\n_mongoose2.default.connection.on('error', function (err) {\n  _logger2.default.error('Mongoose default connection error: ' + err);\n});\n\n_mongoose2.default.connection.on('disconnected', function () {\n  _logger2.default.info('Mongoose default connection disconnected');\n});\n\nprocess.on('SIGINT', function () {\n  _mongoose2.default.connection.close(function () {\n    _logger2.default.info('Mongoose default connection disconnected through app termination');\n    process.exit(0);\n  });\n});\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/models/index.js\n ** module id = 10\n ** module chunks = 0\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _url = require('url');\n\nvar _url2 = _interopRequireDefault(_url);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar config = {\n  host: process.env.OPENSHIFT_MONGODB_DB_HOST || '127.0.0.1',\n  port: process.env.OPENSHIFT_MONGODB_DB_PORT || 27017,\n  user: process.env.OPENSHIFT_MONGODB_DB_USERNAME,\n  pass: process.env.OPENSHIFT_MONGODB_DB_PASSWORD,\n  protocol: 'mongodb',\n  db: 'lova'\n};\n\nvar host = config.host;\nvar port = config.port;\nvar user = config.user;\nvar pass = config.pass;\nvar protocol = config.protocol;\nvar db = config.db;\n\nconfig.uri = _url2.default.format({\n  protocol: protocol + ':',\n  slashes: true,\n  auth: user && pass ? user + ':' + pass : null,\n  hostname: host,\n  port: port,\n  pathname: '/' + db\n});\n\nexports.default = config;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/config/mongodb.js\n ** module id = 13\n ** module chunks = 0\n **/","'use strict';\n\nvar winston = require('winston');\n\nvar logger = new winston.Logger({\n  transports: [new winston.transports.Console({ level: 'silly', timestamp: true })]\n});\nlogger.cli();\n\nmodule.exports = logger;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/utils/logger.js\n ** module id = 14\n ** module chunks = 0\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _mongoose = require('mongoose');\n\nvar _mongoose2 = _interopRequireDefault(_mongoose);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Schema = _mongoose2.default.Schema;\n\nvar CounterSchema = new Schema({\n  _id: String,\n  seq: Number\n});\n\nCounterSchema.statics.getNewId = function (name, callback) {\n  return new Promise(function (resolve, reject) {\n    undefined.collection.findAndModify({ _id: name }, [], { $inc: { seq: 1 } }, { new: true, upsert: true }, function (err, result) {\n      if (callback) {\n        callback(err, result);\n      }\n      if (err) {\n        reject({ err: err, result: result });\n        return;\n      }\n      resolve({ err: err, result: result });\n    });\n  });\n};\n\nexports.default = _mongoose2.default.model('counter', CounterSchema);\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/models/counter.js\n ** module id = 16\n ** module chunks = 0\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _mongoose = require('mongoose');\n\nvar _mongoose2 = _interopRequireDefault(_mongoose);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Schema = _mongoose2.default.Schema;\n\nvar PrizeSchema = new Schema({\n  _id: { type: Number, require: true, unique: true },\n  name: { type: String, require: true },\n  rate: { type: Number, require: true },\n  date: { type: Date, require: true }\n}, { id: false });\n\nPrizeSchema.virtual('id').get(function () {\n  return this._id;\n});\n\nPrizeSchema.set('toJSON', {\n  virtuals: true\n});\n\nexports.default = _mongoose2.default.model('prize', PrizeSchema);\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/models/prize.js\n ** module id = 17\n ** module chunks = 0\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _mongoose = require('mongoose');\n\nvar _mongoose2 = _interopRequireDefault(_mongoose);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Schema = _mongoose2.default.Schema;\n\nvar ServantSchema = new Schema({\n  _id: { type: Number, require: true, unique: true },\n  tribe_id: { type: Number, require: true },\n  tribe_name: { type: String, require: true },\n  tribe_code: { type: Number, require: true },\n  type: String,\n  name: String,\n  cost: Number,\n  range: Number,\n  release_date: Date,\n  update_date: Date,\n  illustration_by: String,\n  character_voice: String,\n  oral_tradition: String,\n  skill: {\n    active: {\n      name: String,\n      designation: String,\n      effect: String,\n      description: String,\n      ap: [Number],\n      cd: [Number]\n    },\n    passive: {\n      name: String,\n      designation: String,\n      effect: String,\n      description: String,\n      ap: [Number],\n      cd: [Number]\n    }\n  },\n  status: {\n    1: {\n      hp: Number,\n      ap: Number,\n      atk: Number,\n      pow: Number,\n      def: Number,\n      res: Number,\n      ms: Number,\n      as: Number\n    },\n    20: {\n      hp: Number,\n      ap: Number,\n      atk: Number,\n      pow: Number,\n      def: Number,\n      res: Number,\n      ms: Number,\n      as: Number\n    }\n  }\n}, { id: false });\n\nServantSchema.virtual('id').get(function () {\n  return this._id;\n});\n\nServantSchema.set('toJSON', {\n  virtuals: true\n});\n\nexports.default = _mongoose2.default.model('servant', ServantSchema);\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/models/servant.js\n ** module id = 18\n ** module chunks = 0\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _mongoose = require('mongoose');\n\nvar _mongoose2 = _interopRequireDefault(_mongoose);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Schema = _mongoose2.default.Schema;\n\nvar ServantrankingShema = new Schema({\n  _id: { type: Number, require: true, unique: true },\n  date: { type: Date, require: true },\n  mode: { type: String, require: true },\n  map: { type: String, require: true },\n  queue: { type: String, require: true },\n  servant_id: { type: Number, require: true },\n  seq: { type: Number, require: true },\n  rank: { type: Number, require: true },\n  score: { type: Number, require: true }\n}, { id: false });\n\nServantrankingShema.virtual('id').get(function () {\n  return this._id;\n});\n\nServantrankingShema.set('toJSON', {\n  virtuals: true\n});\n\nexports.default = _mongoose2.default.model('servantranking', ServantrankingShema);\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/models/servantranking.js\n ** module id = 19\n ** module chunks = 0\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _mongoose = require('mongoose');\n\nvar _mongoose2 = _interopRequireDefault(_mongoose);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Schema = _mongoose2.default.Schema;\n\nvar SpellrankingShema = new Schema({\n  _id: { type: Number, require: true, unique: true },\n  date: { type: Date, require: true },\n  map: { type: String, require: true },\n  queue: { type: String, require: true },\n  spell_id: { type: Number, require: true },\n  seq: { type: Number, require: true },\n  rank: { type: Number, require: true },\n  score: { type: Number, require: true }\n}, { id: false });\n\nSpellrankingShema.virtual('id').get(function () {\n  return this._id;\n});\n\nSpellrankingShema.set('toJSON', {\n  virtuals: true\n});\n\nexports.default = _mongoose2.default.model('spellranking', SpellrankingShema);\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/models/spellranking.js\n ** module id = 20\n ** module chunks = 0\n **/","'use strict';\n\nvar _marked = [root].map(regeneratorRuntime.mark);\n\nfunction root() {\n  return regeneratorRuntime.wrap(function root$(_context) {\n    while (1) switch (_context.prev = _context.next) {\n      case 0:\n        this.body = { node_version: process.version };\n\n      case 1:\n      case 'end':\n        return _context.stop();\n    }\n  }, _marked[0], this);\n}\n\nmodule.exports = root;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/controllers/root.js\n ** module id = 21\n ** module chunks = 0\n **/","'use strict';\n\nvar _marked = [servantsStatistics].map(regeneratorRuntime.mark);\n\nvar _ = require('lodash');\nvar models = require('../models');\n\nfunction servantsStatistics() {\n  var d, params;\n  return regeneratorRuntime.wrap(function servantsStatistics$(_context) {\n    while (1) switch (_context.prev = _context.next) {\n      case 0:\n        _context.next = 2;\n        return models.servantranking.findOne({}).sort({ date: -1 }).exec();\n\n      case 2:\n        _context.t0 = _context.sent.date;\n\n        if (_context.t0) {\n          _context.next = 5;\n          break;\n        }\n\n        _context.t0 = new Date();\n\n      case 5:\n        d = _context.t0;\n        _context.t1 = this.query.term;\n        _context.next = _context.t1 === 'day' ? 9 : _context.t1 === 'month' ? 10 : 11;\n        break;\n\n      case 9:\n        return _context.abrupt('break', 11);\n\n      case 10:\n        d = new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate() - 30));\n\n      case 11:\n        params = _.pick(this.query, function (value, key) {\n          return ['servant_id', 'mode', 'map', 'queue'].indexOf(key) > -1;\n        });\n\n        params.date = { $gte: d };\n\n        _context.next = 15;\n        return models.servantranking.find(params, '-_id servant_id date mode map queue score').sort({ date: 1 }).exec();\n\n      case 15:\n        this.body = _context.sent;\n\n      case 16:\n      case 'end':\n        return _context.stop();\n    }\n  }, _marked[0], this);\n}\n\nmodule.exports = servantsStatistics;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/controllers/servants-statistics.js\n ** module id = 22\n ** module chunks = 0\n **/","'use strict';\n\nvar _marked = [servants, getLastDate, getStatistics].map(regeneratorRuntime.mark);\n\nvar models = require('../models');\n\nfunction servants() {\n  var fields, id, _servants, _statistics, servants, statistics;\n\n  return regeneratorRuntime.wrap(function servants$(_context) {\n    while (1) switch (_context.prev = _context.next) {\n      case 0:\n        fields = (this.query.fields || '').replace(',', ' ');\n        id = this.params.id;\n\n        if (!id) {\n          _context.next = 16;\n          break;\n        }\n\n        _context.next = 5;\n        return models.servant.findOne({ _id: id }, fields).exec();\n\n      case 5:\n        _servants = _context.sent;\n\n        if (!(typeof this.query.with_statistic == 'undefined')) {\n          _context.next = 9;\n          break;\n        }\n\n        this.body = _servants;\n        return _context.abrupt('return');\n\n      case 9:\n        _servants = deepCopy(_servants);\n        _context.next = 12;\n        return getStatistics(id);\n\n      case 12:\n        _statistics = _context.sent;\n\n        _servants = mergeStatistics(_servants, _statistics);\n        this.body = _servants;\n        return _context.abrupt('return');\n\n      case 16:\n        _context.next = 18;\n        return models.servant.find({}, fields).sort({ _id: 1 }).exec();\n\n      case 18:\n        servants = _context.sent;\n\n        if (!(typeof this.query.with_statistic == 'undefined')) {\n          _context.next = 22;\n          break;\n        }\n\n        this.body = servants;\n        return _context.abrupt('return');\n\n      case 22:\n        servants = deepCopy(servants);\n        _context.next = 25;\n        return getStatistics();\n\n      case 25:\n        statistics = _context.sent;\n\n        servants.forEach(function (e) {\n          e = mergeStatistics(e, statistics);\n        });\n        this.body = servants;\n\n      case 28:\n      case 'end':\n        return _context.stop();\n    }\n  }, _marked[0], this);\n}\n\nfunction getLastDate() {\n  var statistic;\n  return regeneratorRuntime.wrap(function getLastDate$(_context2) {\n    while (1) switch (_context2.prev = _context2.next) {\n      case 0:\n        _context2.next = 2;\n        return models.servantranking.findOne().sort({ date: -1 }).exec();\n\n      case 2:\n        statistic = _context2.sent;\n        return _context2.abrupt('return', statistic ? statistic.date : new Date());\n\n      case 4:\n      case 'end':\n        return _context2.stop();\n    }\n  }, _marked[1], this);\n}\n\nfunction getStatistics(servantId) {\n  var date, params, statistics;\n  return regeneratorRuntime.wrap(function getStatistics$(_context3) {\n    while (1) switch (_context3.prev = _context3.next) {\n      case 0:\n        _context3.next = 2;\n        return getLastDate();\n\n      case 2:\n        date = _context3.sent;\n        params = {\n          date: date,\n          map: 'all',\n          queue: 'all'\n        };\n\n        if (servantId) {\n          params['servant_id'] = servantId;\n        }\n        _context3.next = 7;\n        return models.servantranking.find(params, '-_id servant_id mode score').exec();\n\n      case 7:\n        statistics = _context3.sent;\n\n        statistics = statistics.reduce(function (prev, current) {\n          var servantId = current.servant_id;\n          if (!prev[servantId]) {\n            prev[servantId] = {};\n          }\n          prev[servantId][current.mode] = current.score;\n          return prev;\n        }, {});\n        return _context3.abrupt('return', statistics);\n\n      case 10:\n      case 'end':\n        return _context3.stop();\n    }\n  }, _marked[2], this);\n}\n\nfunction deepCopy(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nfunction mergeStatistics(servants, statistics) {\n  if (!statistics[servants.id]) {\n    statistics[servants.id] = { win: 0, used: 0 };\n  }\n  servants['win_rate'] = statistics[servants.id]['win'] || 0;\n  servants['used_rate'] = statistics[servants.id]['used'] || 0;\n  return servants;\n}\n\nmodule.exports = servants;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/controllers/servants.js\n ** module id = 24\n ** module chunks = 0\n **/","'use strict';\n\nvar _marked = [sitemap].map(regeneratorRuntime.mark);\n\nvar xmlify = require('xmlify');\nvar models = require('../models');\n\nfunction sitemap() {\n  var servants, urls, urlset;\n  return regeneratorRuntime.wrap(function sitemap$(_context) {\n    while (1) switch (_context.prev = _context.next) {\n      case 0:\n        _context.next = 2;\n        return models.servant.find({}, 'id').sort({ _id: 1 }).exec();\n\n      case 2:\n        servants = _context.sent;\n        urls = [];\n\n        urls.push('/');\n        urls.push('/about/');\n        urls.push('/charts/');\n        urls.push('/deck/');\n        urls.push('/prize/');\n        servants.forEach(function (e) {\n          urls.push('/servants/' + e.id + '/');\n        });\n\n        urls = urls.map(function (loc) {\n          return { loc: 'http://lova-fiahfy.rhcloud.com' + loc };\n        });\n\n        urlset = {\n          _xmlns: 'http://www.sitemaps.org/schemas/sitemap/0.9',\n          url: urls\n        };\n\n        this.type = 'xml';\n        this.body = xmlify(urlset, 'urlset');\n\n      case 14:\n      case 'end':\n        return _context.stop();\n    }\n  }, _marked[0], this);\n}\n\nmodule.exports = sitemap;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/controllers/sitemap.js\n ** module id = 25\n ** module chunks = 0\n **/","'use strict';\n\nvar _marked = [spellStatistics].map(regeneratorRuntime.mark);\n\nvar _ = require('lodash');\nvar models = require('../models');\n\nfunction spellStatistics() {\n  var d, params;\n  return regeneratorRuntime.wrap(function spellStatistics$(_context) {\n    while (1) switch (_context.prev = _context.next) {\n      case 0:\n        _context.next = 2;\n        return models.spellranking.findOne({}).sort({ date: -1 }).exec();\n\n      case 2:\n        _context.t0 = _context.sent.date;\n\n        if (_context.t0) {\n          _context.next = 5;\n          break;\n        }\n\n        _context.t0 = new Date();\n\n      case 5:\n        d = _context.t0;\n        _context.t1 = this.query.term;\n        _context.next = _context.t1 === 'day' ? 9 : _context.t1 === 'month' ? 10 : 11;\n        break;\n\n      case 9:\n        return _context.abrupt('break', 11);\n\n      case 10:\n        d = new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate() - 30));\n\n      case 11:\n        params = _.pick(this.query, function (value, key) {\n          return ['servant_id', 'map', 'queue'].indexOf(key) > -1;\n        });\n\n        params.date = { $gte: d };\n\n        _context.next = 15;\n        return models.spellranking.find(params, '-_id spell_id date map queue score').sort({ date: 1 }).exec();\n\n      case 15:\n        this.body = _context.sent;\n\n      case 16:\n      case 'end':\n        return _context.stop();\n    }\n  }, _marked[0], this);\n}\n\nmodule.exports = spellStatistics;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/controllers/spells-statistics.js\n ** module id = 27\n ** module chunks = 0\n **/","'use strict';\n\nvar fs = require('fs');\n\n// fs.readdirSync(__dirname).forEach(function(file) {\n//   if (file !== 'index.js') {\n//     let fileName = file.split('.')[0];\n//     let moduleName = fileName.replace(/-(\\w)/, function(match, p1, offset, string) {\n//       return p1.toUpperCase();\n//     });\n//     module.exports[moduleName] = require('./' + fileName);\n//   }\n// });\n\nmodule.exports = {\n  servants: require('./servants')\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/controllers/ranking/index.js\n ** module id = 28\n ** module chunks = 0\n **/","'use strict';\n\nvar _marked = [servants].map(regeneratorRuntime.mark);\n\nvar models = require('../../models');\n\nfunction servants() {\n  var d;\n  return regeneratorRuntime.wrap(function servants$(_context) {\n    while (1) switch (_context.prev = _context.next) {\n      case 0:\n        d = undefined;\n\n        if (!(this.params.year && this.params.month && this.params.date)) {\n          _context.next = 5;\n          break;\n        }\n\n        d = new Date(Date.UTC(this.params.year, this.params.month - 1, this.params.date));\n        _context.next = 8;\n        break;\n\n      case 5:\n        _context.next = 7;\n        return models.servantranking.findOne({ mode: this.params.mode, map: 'all', queue: 'all' }).sort({ date: -1 }).exec();\n\n      case 7:\n        d = _context.sent.date;\n\n      case 8:\n        _context.next = 10;\n        return models.servantranking.find({ mode: this.params.mode, map: 'all', queue: 'all', date: d }).sort({ seq: 1 }).exec();\n\n      case 10:\n        this.body = _context.sent;\n\n      case 11:\n      case 'end':\n        return _context.stop();\n    }\n  }, _marked[0], this);\n}\n\nmodule.exports = servants;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/server/controllers/ranking/servants.js\n ** module id = 29\n ** module chunks = 0\n **/"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC3JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;","sourceRoot":""}